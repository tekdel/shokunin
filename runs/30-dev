#!/bin/bash
# runs/dev - Development tools and languages

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DOTFILES_DIR="$SCRIPT_DIR/../dotfiles"

# Build tools
sudo pacman -S --needed --noconfirm \
    cmake \
    make \
    gcc \
    clang \
    llvm

# Development utilities
sudo pacman -S --needed --noconfirm \
    shellcheck \
    shfmt \
    mise \
    go \
    rust \
    rustup

# Refresh shell's command cache so mise is found
hash -r

# Copy mise config before installing tools
if [ -f "$DOTFILES_DIR/.mise.toml" ]; then
    cp "$DOTFILES_DIR/.mise.toml" ~/
    mise trust ~/.mise.toml 2>/dev/null || true
    echo "âœ“ .mise.toml copied and trusted"
fi

# Install languages via mise (Node.js, Python)
echo "Installing Node.js and Python via mise..."
# Skip GPG verification (keyservers are unreliable)
mise settings set node.gpg_verify false
mise install node@lts -y
mise install python@3.12 -y
mise use --global node@lts
mise use --global python@3.12

# Install tree-sitter-cli for Neovim
echo "Installing tree-sitter-cli for Neovim..."
npm install -g tree-sitter-cli

echo "Development tools installed successfully!"
echo "Node.js and Python managed by mise"
