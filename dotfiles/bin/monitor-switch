#!/bin/bash
# Monitor switch script - simple and reliable
# Supports Z13 (1920x1200), Framework 13 2.2K (2256x1504), and Framework 13 2.8K (2880x1920)

LAPTOP="eDP-1"

# Force laptop on (recovery mode) - auto-detects resolution
if [[ "$1" == "-l" ]]; then
    hyprctl keyword monitor "$LAPTOP,preferred,auto,1"
    exit 0
fi

# Check if external monitor is currently active
# Use 'hyprctl monitors' (not 'all') to only see active monitors
external_connected=$(hyprctl monitors | grep -c "LG UltraFine" || true)

if [ "$external_connected" -gt 0 ]; then
    # External connected
    hyprctl keyword monitor "desc:LG Electronics LG UltraFine 901NTDV6P994,3840x2160,0x0,1"
    hyprctl keyword monitor "$LAPTOP,disable"
    notify-send -t 3000 "Monitor" "External"
else
    # Laptop only - force enable first (in case it was disabled), then configure
    hyprctl keyword monitor "$LAPTOP,preferred,auto,1"
    # Small delay to let the display initialize
    sleep 0.3
    # Re-apply to ensure proper configuration
    hyprctl keyword monitor "$LAPTOP,preferred,auto,1"
    notify-send -t 3000 "Monitor" "Laptop"
fi
