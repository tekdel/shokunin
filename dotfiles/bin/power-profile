#!/bin/bash
# power-profile - Switch power profiles using walker

CURRENT=$(powerprofilesctl get)

# Define profiles with friendly names
declare -A PROFILES=(
    ["Power Saver"]="power-saver"
    ["Balanced"]="balanced"
    ["Performance"]="performance"
)

# Build options with current marker
OPTIONS=""
for name in "Power Saver" "Balanced" "Performance"; do
    if [[ "${PROFILES[$name]}" == "$CURRENT" ]]; then
        OPTIONS+="$name (current)\n"
    else
        OPTIONS+="$name\n"
    fi
done

CHOICE=$(echo -e "$OPTIONS" | walker --dmenu --placeholder "Power Profile")

# Extract name (remove " (current)" suffix if present)
NAME=$(echo "$CHOICE" | sed 's/ (current)$//')
PROFILE="${PROFILES[$NAME]}"

if [[ -n "$PROFILE" && "$PROFILE" != "$CURRENT" ]]; then
    powerprofilesctl set "$PROFILE"
    notify-send "Power Profile" "Switched to $NAME"
fi
