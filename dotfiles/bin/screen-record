#!/bin/bash
# screen-record - Toggle screen recording with wf-recorder
# Super+Shift+R to start/stop recording

RECORDINGS_DIR="$HOME/videos/recordings"
PIDFILE="/tmp/wf-recorder.pid"

mkdir -p "$RECORDINGS_DIR"

if [ -f "$PIDFILE" ] && kill -0 "$(cat "$PIDFILE")" 2>/dev/null; then
    # Recording in progress - stop it
    kill -SIGINT "$(cat "$PIDFILE")"
    rm -f "$PIDFILE"
    notify-send "Screen Recording" "Recording saved to ~/videos/recordings" -i camera-video
else
    # Start new recording
    FILENAME="$RECORDINGS_DIR/recording-$(date +%Y%m%d-%H%M%S).mp4"

    # Select area or fullscreen
    GEOMETRY=$(slurp 2>/dev/null)

    if [ -n "$GEOMETRY" ]; then
        # Record selected area
        wf-recorder -g "$GEOMETRY" -f "$FILENAME" &
    else
        # Record fullscreen (slurp was cancelled)
        wf-recorder -f "$FILENAME" &
    fi

    echo $! > "$PIDFILE"
    notify-send "Screen Recording" "Recording started (Super+Shift+R to stop)" -i camera-video
fi
